Оглавление

	В 1с товару поставили галочку "Не для интернет магазина", но он всеравно отображается на сайте

В 1с товару поставили галочку "Не для интернет магазина", но он всеравно отображается на сайте

	- попросить коды (артикулы) товаров у ответсвенных за проекты

	- на 4.09.19 если в 1с стоит галочка "Не для интернет магазина", то это значит, что продукт не должен быть на сайтах korallmicro и istore

	- ищем в бд magic лишние связи товара с категорией для сайтов korallmicro и istore

		SELECT 
		    c_c.id,
		    c_c.type
		FROM
		    magic.catalog_distributions c_d
		        LEFT JOIN
		    magic.catalog_catalog c_c ON c_d.catalog_id = c_c.id
		WHERE
		    product_id = 1987
		        AND c_c.type IN ('korallmicro' , 'istore');

	- удаляем из бд magic лишние связи товара с категорией для сайтов korallmicro и istore

		DELETE FROM
			magic.catalog_distributions
		WHERE
			product_id = 1987
				AND catalog_id IN (281904, 319023)

	- ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

	Если не помогло, то: 

		- просим ответственного за проект убрать у продукта в 1с галочку "Не для интернет магазина"

		- ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

		- просим ответственного за проект вернуть продукту в 1с галочку "Не для интернет магазина"

		- ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

Ошибка при синхронизации. Кол-во распределенного товара вне диапозона

	Это происходит, потому что кол-во продуктов в 1с сильно отличается от кол-ва продуктов в magic.

	Перед тем, как начать исправлять нужно связаться с ответственным за проект, рассказать о проблеме и получить разрешение на выполнение синхронизации вручную и без сравнения кол-ва товаров.

	Если ответсвенный даёт добро, то:

		- смотрим письмо об ошибке и находим для какого магазина она произошла (snr, korallmicro, istore)

			Task was called with args: [] kwargs: {u'shop_type': u'korallmicro'}.

			Это говорит, что ошибка произошла при синхронизации для korallmicro.

		- заходим на боевой magic

			ssh devel@192.168.7.76

		- открываем файл с логами выполняющихся фоновых задач

			tail -f ~/log/magic-celery-system.txt

		- заходим на боевой magic

			ssh devel@192.168.7.76

		- переходим в корень проекта

			cd ~/www/magic

		- смотрим в открытый файл с логами выполняющихся фоновых задач и убеждаемся, что нет запущенных sync_shop

		- выполняем синхронизацию для нужного магазина вручную и без сравнения кол-ва товаров

			bin/celery call -A app_celery sync_shop --queue=system --args='["название нужного магазина, например istore", false]'