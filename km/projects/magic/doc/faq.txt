Оглавление

	Галочка "Не для интернет магазина"

	Кол-во распределенного товара вне диапозона

	Бесконечный цикл при создании каталогов

	Проблема с выгодными предложениями

	Проблема с количеством товара на сайте

Галочка "Не для интернет магазина"

	В 1с товару поставили галочку "Не для интернет магазина", но он всеравно отображается на сайте

		Причина: потому что товар отвязан от категории в 1c. Смотреть в разделе "Иерархия групп объектов обмена".

		На 4.09.19 если в 1с стоит галочка "Не для интернет магазина", то это значит, что продукт не должен быть на сайтах korallmicro и istore.

		Если говорить в терминах 1с, то номеклатура не имеет связи с каталогом.

		Для того, чтобы исправить ситуацию нужно:

			привязать номенклатуру к каталогу в 1с

			найти в бд magic лишние связи товара с категорией для сайтов korallmicro и istore:

				SELECT
				    c_c.id,
				    c_c.type
				FROM
				    magic.catalog_distributions c_d
				        LEFT JOIN
				    magic.catalog_catalog c_c ON c_d.catalog_id = c_c.id
				WHERE
				    product_id = 1987
				        AND c_c.type IN ('korallmicro' , 'istore');

			удаляем из бд magic лишние связи товара с категорией для сайтов korallmicro и istore:

				DELETE FROM
				    magic.catalog_distributions
				WHERE
				    product_id = 1987
				        AND catalog_id IN (281904, 319023)

			ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

		Если не помогло, то:

			просим ответственного за проект убрать у продукта в 1с галочку "Не для интернет магазина"

			ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

			просим ответственного за проект вернуть продукту в 1с галочку "Не для интернет магазина"

			ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

Кол-во распределенного товара вне диапозона

	Ошибка при синхронизации с 1с "Кол-во распределенного товара вне диапозона".

		Причина: потому что кол-во продуктов в 1с сильно отличается от кол-ва продуктов в magic.

		Если ответственный за проект много работал в 1с с продуктами, то это нормальная ситуация.

		Для решения проблемы нужно связаться с ответственным за проект и узнать работал ли он с продуктами и каталогами в 1с. 

			Если работал, то просим у ответсвенного за проект разрешения на "синхронизацию без доверительного интервала".

			Если разрешает, то:

				находим на рабочей почте письмо об ошибке и смотрим для какого магазина она произошла (snr, korallmicro, istore)

					Task was called with args: [] kwargs: {u'shop_type': u'korallmicro'}

					Это говорит, что ошибка произошла при синхронизации для korallmicro

				в 1-ой консоле заходим на боевой magic

					ssh devel@192.168.7.76

					открываем файл с логами, выполняющихся фоновых задач

						tail -f ~/log/magic-celery-system.txt

				во 2-ой консоле заходим на боевой magic

					ssh devel@192.168.7.76

					переходим в корень проекта

						cd ~/www/magic

					смотрим в открытый файл с логами выполняющихся фоновых задач и убеждаемся, что нет запущенных sync_shop

					выполняем синхронизацию для нужного магазина вручную и без сравнения кол-ва товаров

						bin/celery call -A app_celery sync_shop --queue=system --args='["название нужного магазина, например istore", false]'

		Если ответсвенного за проект не разрешает выполнить "синхронизацию без доверительного интервала", то исследуем код и ищем проблему.

			открываем /magic/modules/catalog/tasks.py

			ищем там if use_confidence_interval

			разбираемся

Бесконечный цикл при создании каталогов

	Ошибка при синхронизации с 1с "Бесконечный цикл при создании каталогов".

		Причина: потому что в 1с помеченный "на удаление" каталог, не удаляется из базы 1c_8_raw.

		Смотреть разницу между интерфейсом 1с и базой 1c_8_raw.

			В 1с каталоги будут помечены на удаление, а в 1c_8_raw в поле _ПометкаУдаление будет стоять 0.

			Можно посмотреть с помощью следующего запроса:

				SELECT 
					* 
				FROM 
					1C_8_RAW.КаталогиИнтернетМагазина
				WHERE 
					uid = 'сюда подставляем uid каталога на котором валится скрипт, например 61862fdd-f59c-11e1-82bc-002655df3ac1';

		Для решения проблемы нужно обратиться в сектор 1с и попросить полностью перезалить бд 1c_8_raw.

Проблема с выгодными предложениями

	После изменений выгодных предложений они не отображаются на сайтах (korallmicro, snr, istore).

	Причина: потому что падает синхронизация magic с 1с.

	Для решения проблемы:

		узнаем у сообщивших о проблеме, что именно они меняли и где это должно быть на сайтах.

		заходим на боевой magic

			ssh devel@192.168.7.76

			переходим в корень проекта

				cd ~/www/magic

			открываем shell

				bin/manage shell

			запускаем синхронизацию выгодных предложений вручную

				from catalog.tasks import *

				from snr.tasks import *

				sync_offers_korallmicro.delay()

				sync_korallmicro.delay()

				sync_offers_snr.delay()

				sync.delay(site_models='sales_base_models.models', shop_type='snr_new')

		ждем пока закончатся фоновые задачи и обновится кэш

		проверяем, что изменения вступили в силу

Пересекающиеся товары в выгодных предложениях

	Причина: обе акции активны.

	Каждой акции задается время действия.

	Если в акциях есть одинаковые товары и они обе активны, то товары будут пересекаться и это нормально.

	Поэтому первым делом нужно узнать у того, кто написал о проблеме о каких акциях идет речь и проверить в срок действия этих акций.

		заходим в раздел с акциями

			http://magic.km-union.ru/catalog/offers/

		выбираем нужный интернет магазин

		справа в колонке "Типы выгодных предложений" подгрузятся все выгодные предложения этого магазина

		находим и нажимаем на нужное выгодное предложение

		скролим в самый низ и ищём колонку "Выгодные предложения"

		в колонку "Выгодные предложения" должно подгрузиться срок действия выгодного предложения

	Если обе акции активны и вних есть одинаковые товары, то они будут пересекаться. Это нормально поведение.

	Доносим эту мысль человеку, который сообщил об ошибке.

Проблема с количеством товара на сайте

	На 17.08.19 проблемы на этапах:

		1c

			косяк с вид-подвид в распределении.

		новинки на коралле

			у каталога в котором находится товар не стоит галочка "приоритетная группа", а до этого стояла.

				231367

				/catalog/catalog/281727/change/

				Если у любого родительского каталога убрать галочку "приоритетная группа", то у вложенных она тоже исчезнет

				    def set_priority_group(self):
				        """Устанавливает новое значение атрибута is_priority_group для
				        записи и всех ее вложенных записей.

				        """
				        self.children.all().update(is_priority_group=self.is_priority_group)
				        for nested in self.children.all():
				            nested.set_priority_group()

				В таске sync_shop модуля каталог is_priority_group берется из magic

			+ все везде есть и всеравно товар не появляется в новинках

				232483
				
				нет остатков

		magic

			в 1С в виде-подвиде "смартфон-запчасть" (то есть в правилах распределения задано неправильно, а в magic все правильно - "смартфон-смартфон" и на сайте тоже в смартфонах.

				Cмартфон

					198186

		dp

			проблемы с синхронизацией цен и остатков.

	По мнению ответсвенных за интернет-магазины на сайтах korallmicro, snr и istore должно быть больше товаров чем есть на данный момент.

	Изначально продукты создаются в 1с.

	Из 1с продукты выгружаются в бд 1c_8_raw.

	Из бд 1c_8_raw продукты выгружаются в бд magic, таблица ones_products.

	Из таблицы ones_products продукты выгружаются в catalog_products, catalog_catalog и создаются связи в catalog_distributions согласно правилам из catalog_rules.

	Из бд magic продукты попадают в бд конкретных сайтов (korallmicro, snr, istore).

	Условия по которым продукт считается пригодным для выгрузки:

		СнятаСПродажи = 0/1

		НеДляПродажи = 0

		НеДляРозницы = 0

		_ПометкаУдаления = 0

		# созданные минимум 12 часов назад
		ДатаСоздания <= date_add(now(),interval -12 hour)

	Из 1с в magic идет выгрузка в таблицы из модуля ones в таске sync_db.

	Затем для каждого магазина запускается таск sync_shop.

	Внутри таска sync_shop сначала идет распределение продуктов в magic по таблицам catalog_products, catalog_catalog и catalog_distributions c помощью метода sync, а затем уже в бд конкретного магазина.

	Korallmicro

		Выгрузка товаров из 1с в 1c_8_raw

			SELECT 
				COUNT(*)
			FROM 
				1C_8_RAW.Номенклатура
			WHERE
				uid IN (
					SELECT 
						Номенклатура
					FROM
						1C_8_RAW.СвязиКаталоговИнтернетМагазина
					WHERE
						КаталогИнтернетМагазина IN (
							SELECT
								uid
							FROM
								1C_8_RAW.КаталогиИнтернетМагазина
							WHERE
								ПланОбмена = (
									SELECT 
										uid
									FROM 
										1C_8_RAW.ПланОбмена
									WHERE
										Наименование = 'Korallmicro'
								)
							AND
								_ПометкаУдаления = 0
						)
				)
			AND
				НеДляПродажи = 0
			AND
				НеДляРозницы = 0
			AND
				_ПометкаУдаления = 0
			AND
				ДатаСоздания <= date_add(now(),interval -12 hour);

			>>> 25101

		Выгрузка товаров из 1c_8_raw в magic

			SELECT
				COUNT(*)
			FROM
				magic.catalog_products as p
			JOIN
				magic.catalog_distributions as d
			ON
				d.product_id = p.code
			JOIN
				magic.catalog_catalog as c
			ON
				c.id = d.catalog_id
			WHERE
				c.type = 'korallmicro';

			>>> 23202

		Те у которых нет связи с каталогом korallmicro

			SELECT 
				COUNT(*)
			FROM 
				1C_8_RAW.Номенклатура
			WHERE
				uid IN (
					SELECT 
						Номенклатура
					FROM
						1C_8_RAW.СвязиКаталоговИнтернетМагазина
					WHERE
						КаталогИнтернетМагазина IN (
							SELECT
								uid
							FROM
								1C_8_RAW.КаталогиИнтернетМагазина
							WHERE
								ПланОбмена = (
									SELECT 
										uid
									FROM 
										1C_8_RAW.ПланОбмена
									WHERE
										Наименование = 'Korallmicro'
								)
							AND
								_ПометкаУдаления = 0
						)
				)
			AND
				НеДляПродажи = 0
			AND
				НеДляРозницы = 0
			AND
				_ПометкаУдаления = 0
			AND
				ДатаСоздания <= date_add(now(),interval -12 hour)
			AND
				Код NOT IN (
					SELECT
						p.code
					FROM
						magic.catalog_products as p
					JOIN
						magic.catalog_distributions as d
					ON
						d.product_id = p.code
					JOIN
						magic.catalog_catalog as c
					ON
						c.id = d.catalog_id
					WHERE
						c.type = 'korallmicro'
				)
			ORDER BY ДатаСоздания DESC

			>>> 1943

		Провереям, что у 1943 продуктов нет связи с каталогом korallmicro, а должна быть

			SELECT 
			    p.code, c.type
			FROM
			    magic.catalog_products AS p
			        JOIN
			    magic.catalog_distributions AS d ON d.product_id = p.code
			        JOIN
			    magic.catalog_catalog AS c ON c.id = d.catalog_id
			WHERE
			    p.code IN (
			        219587,
			        203907
			    );

		Провереям, что у 1943 продуктов есть связи с каталогом korallmicro в 1с_8_raw

			SELECT
				count(*)
				product.Код,
				category_product.КаталогИнтернетМагазина
			FROM
			    1C_8_RAW.Номенклатура AS product
			        JOIN
			    1C_8_RAW.СвязиКаталоговИнтернетМагазина AS category_product ON category_product.Номенклатура = product.uid
					JOIN
				1C_8_RAW.КаталогиИнтернетМагазина AS category ON category.uid = category_product.КаталогИнтернетМагазина
			WHERE
				category.ПланОбмена = (
					SELECT
						plan.uid
					FROM
						1C_8_RAW.ПланОбмена AS plan
					WHERE
						plan.Наименование = 'korallmicro'
				)
				AND
					product.Код IN (
						213787, 
						206999,
					);

		Термины

			номенклатура == продукт

			каталог == категория

			связь продукта с категорией == СвязиКаталоговИнтернетМагазина == catalog_distributions

		Смотрим продукт 1с - magic

			SELECT 
			    *
			FROM
			    1C_8_RAW.Номенклатура
			WHERE
				Код = 184512;

			------

			SELECT 
			    *
			FROM
			    magic.catalog_products
			WHERE
			    code = 213787;

		Смотрим связь продукта с категорией 1с - magic

			SELECT 
			    *
			FROM
			    1C_8_RAW.СвязиКаталоговИнтернетМагазина
			WHERE
				Номенклатура = '33ebd596-a479-11e9-80e1-6805ca44419c';

			------

			SELECT 
			    *
			FROM
			    magic.catalog_distributions
			WHERE
			    product_id = 213787;

		Смотрим категории 1с - magic

			SELECT 
			    КаталогиИнтернетМагазина.uid,
			    КаталогиИнтернетМагазина.Наименование,
			    ПланОбмена.Наименование
			FROM
			    1C_8_RAW.КаталогиИнтернетМагазина
			        JOIN
			    1C_8_RAW.ПланОбмена ON КаталогиИнтернетМагазина.ПланОбмена = ПланОбмена.uid
			WHERE
			    КаталогиИнтернетМагазина.uid IN (
					'61863006-f59c-11e1-82bc-002655df3ac1',
			        '801059df-1fbd-11e9-80d9-6805ca44419c',
			        'bd15d28a-2714-11e5-80d9-001b21d8d330',
			        'd155349c-fd61-11e5-93f9-001b21d8d330'
				);

			-------

			SELECT
				full_name,
				type
			FROM
				magic.catalog_catalog
			WHERE
				id IN (318290);

		Смотрим наличие карточки товара в magic и стоит ли date_formed_description

			SELECT 
			    *
			FROM
			    magic.cards_productcard
			WHERE
				code = 213787;

		Смотрим есть ли слепок карточки товара

			SELECT 
			    *
			FROM
			    magic.cards_productcarddescription
			WHERE
				card_id = 60627;

		Смотрим остатки 1с - dp

			SELECT 
			    *
			FROM
			    1C_8_RAW.Остатки
			WHERE
			    Номенклатура = '0978b6c9-cbb4-11e8-80d7-6805ca44419c';

			------

			SELECT 
				* 
			FROM 
				public.remains 
			WHERE 
				pid=197416;

			------

			from sales_base_models.models import * 

			Remains.objects.filter(sid=Site.objects.get(subdomain='www').pk, pid=184512)

		Смотрим наличие цены 1с - dp

			SELECT 
			    *
			FROM
			    1C_8_RAW.Цены
			WHERE
			    Номенклатура = '21609ef0-3b93-11e7-80c7-6805ca44419c';

			------

			SELECT 
				*  
			FROM 
				public.prices 
			WHERE 
				pid=197416;

			------

			from sales_base_models.models import * 

			Prices.objects.filter(sid=Site.objects.get(subdomain='www').pk, pid=184512)

		Смотрим наличие продукта в базе магазина

			SELECT 
				* 
			FROM 
				public.products 
			WHERE 
				id=197416;

		Вид-тип-бренд и каталог

			Нет нужной связи в catalog_distributions и она не может сформироваться, потому что product_uuids = get_product_uuids_for_sale, не берет нужный продукт из-за отсутсвия нужной связи вид-типа-бренда и каталога

				SELECT 
				    *
				FROM
				    magic.catalog_rules;

			Где взять vtb_id

				SELECT 
				    vtb_id
				FROM
				    magic.ones_products
				WHERE
					code = 225550;

			Цепочка

				184512, 228869, 197416

					Номенклатура

						Нет пометок

						SELECT 
						    *
						FROM
						    1C_8_RAW.Номенклатура
						WHERE
							Код = 197416;

					Распределение каталогов сайтов

						"Иерархия объектов обмена"

						Не указал папку

						Не указал правильный вид-подвид

						Вид-подвид не соответсвовал группе

						Папка и бери из неё все

					Мэджик каталоги

						Если видит, то супер

					Мэджик карточка

						Фото, валидация

					В dp "цены и остатки"

						korallmicro

						поиск по всем каталогам

						смотрю папку в иерархии dp

						есть тип цены, но он не влияет на выгрузку

							инэт магаз

							по акции

							ррц рекомендуемая розничная цена производителя

					Закупка кладет товар в папку

						"Если решили переложить в другую папку, то он просто пропадает"

-------

string 'getProducts' (length=11)
array (size=1)
 'where' =>
   array (size=4)
     0 => string '"product"."id" not in (select "pid" from "disabled" where "sid" = 49 and "gid" is null)' (length=87)
     1 => string 'product.id in (select "pid" from "distributions" where "gid" in (select "gid" from "catalogs" where "is_priority_group" is true))' (length=129)
     2 => string '"product"."new" is true' (length=23)
     3 => string '"remain"."km_value" + "remain"."dealer_value" +  "remain"."transit_value"> 0' (length=76)
Array ( [where] => Array ( [0] => "product"."id" not in (select "pid" from "disabled" where "sid" = 49 and "gid" is null) [1] => product.id in (select "pid" from "distributions" where "gid" in (select "gid" from "catalogs" where "is_priority_group" is true)) [2] => "product"."new" is true [3] => "remain"."km_value" + "remain"."dealer_value" + "remain"."transit_value"> 0 ) )

---------

select * from public.products where id = 231367;

select * from public.distributions where pid = 231367;

select * from public.catalogs where gid = 281727;

select * from public.remains where pid = 281727;

select * from public.prices where pid = 281727;


---------


Коды продуктов проведенных за определенный срок

	from cards.models import *

	list(
		ProductCard.objects.filter(
			date_checked__gte=datetime(2019, 9, 18), date_formed_description__isnull=False
		).values_list(
			'code', 
			flat=True
		)
	)

	229630,
	229631,
	229633,
	229634,
	230914,
	231931,
	231932,
	231933,
	231934,
	231935,
	231936,
	231937,
	231938,
	231939,
	231940,
	232456,
	232457,
	232536,
	232538,
	232539,
	232540,
	232577,
	232578,
	232579,
	232580,
	232581,
	232582,
	232583,
	232584,
	232585,
	232586,
	232587,
	232589,
	232590,
	232591,
	232592,
	232593,
	232594,
	232595,
	232596,
	232597,
	232599,
	232600,
	232601,
	232602,
	232603,
	232604,
	232607,
	232609,
	232612,
	232624,
	232636,
	232639,
	232642,
	232647,
	232648,
	232649,
	232650,
	232733,
	232736,
	232758,
	232824,
	232825,
	232901,
	232902,
	232903,
	232904,
	232905,
	232910,
	232912,
	232915,
	232916,
	232917,
	232918,
	232919,
	232927,
	232928,
	232929,
	232941,
	232942,
	232989,
	233022,
	233023,
	233024,
	233025,
	233051,
	233054,
	233055,
	233056,
	233080,
	233083,
	233084,
	233085,
	233086,
	233087,
	233088,
	233089,
	233090,
	233091,
	233092,
	233093,
	233094,
	233095,
	233096

Получим все uid продуктов

	SELECT 
	    uid
	FROM
	    1C_8_RAW.Номенклатура
	WHERE
	    Код IN (229630 , 229631,
	        229633,
	        229634,
	        ...
	    );

Проверим, что каждый привязан к каталогу коралла и он не помечен на удаление

	SELECT 
	    *
	FROM
	    1C_8_RAW.СвязиКаталоговИнтернетМагазина AS category_product
	WHERE
	    category_product.Номенклатура IN (
			'003f2a6a-d2e8-11e9-80e1-6805ca44419c', 
	        '0c3c8cdc-d2e0-11e9-80e1-6805ca44419c',
	        '12151795-d2dc-11e9-80e1-6805ca44419c',
	        '134e6cf4-d2db-11e9-80e1-6805ca44419c',
	        '13d9260a-d2dd-11e9-80e1-6805ca44419c',
	        '16fd532e-d60b-11e9-80e1-6805ca44419c',
	        '1786006a-d49b-11e9-80e1-6805ca44419c',
	        '1c2beb13-d555-11e9-80e1-6805ca44419c',
	        '1fbaa7ac-d2de-11e9-80e1-6805ca44419c',
	        '1fe3f2af-d867-11e9-80e1-6805ca44419c',
	        '223175d4-d62b-11e9-80e1-6805ca44419c',
	        '223198d2-d0a8-11e9-80e1-6805ca44419c',
	        '27192ceb-d546-11e9-80e1-6805ca44419c',
	        '28922d8d-d2e7-11e9-80e1-6805ca44419c',
	        '2a1c9abc-d866-11e9-80e1-6805ca44419c',
	        '2a80f15d-caeb-11e9-80e1-6805ca44419c',
	        '317e730e-d867-11e9-80e1-6805ca44419c',
	        '36d9443e-d2db-11e9-80e1-6805ca44419c',
	        '3727e2c6-d0a9-11e9-80e1-6805ca44419c',
	        '3a350ddd-d2dc-11e9-80e1-6805ca44419c',
	        '3c7771a7-d84c-11e9-80e1-6805ca44419c',
	        '3f4efffd-bf39-11e9-80e1-6805ca44419c',
	        '4129f39e-d2e6-11e9-80e1-6805ca44419c',
	        '41d5d871-caeb-11e9-80e1-6805ca44419c',
	        '43a894ef-d62b-11e9-80e1-6805ca44419c',
	        '4e569507-d2e0-11e9-80e1-6805ca44419c',
	        '4e584b86-d2e8-11e9-80e1-6805ca44419c',
	        '4fdd31c4-d2de-11e9-80e1-6805ca44419c',
	        '4ff6f7f7-caeb-11e9-80e1-6805ca44419c',
	        '51446b50-d540-11e9-80e1-6805ca44419c',
	        '53bff3bf-d546-11e9-80e1-6805ca44419c',
	        '55091eb6-d541-11e9-80e1-6805ca44419c',
	        '57175c6c-d2e3-11e9-80e1-6805ca44419c',
	        '572f88fe-d86a-11e9-80e1-6805ca44419c',
	        '5c07f811-d867-11e9-80e1-6805ca44419c',
	        '5d234285-d2e5-11e9-80e1-6805ca44419c',
	        '61073379-d2dc-11e9-80e1-6805ca44419c',
	        '61cbb306-d2db-11e9-80e1-6805ca44419c',
	        '65ffd60d-d62b-11e9-80e1-6805ca44419c',
	        '6626974f-caeb-11e9-80e1-6805ca44419c',
	        '664498b1-d84c-11e9-80e1-6805ca44419c',
	        '6774a794-d54e-11e9-80e1-6805ca44419c',
	        '697774ff-d499-11e9-80e1-6805ca44419c',
	        '697fe310-d073-11e9-80e1-6805ca44419c',
	        '6a73d0e2-d540-11e9-80e1-6805ca44419c',
	        '6ccb5c50-d3c6-11e9-80e1-6805ca44419c',
	        '6cffa011-aeb2-11e9-80e1-6805ca44419c',
	        '7a0291ca-d2de-11e9-80e1-6805ca44419c',
	        '7d9deac8-d541-11e9-80e1-6805ca44419c',
	        '7e5ba064-caeb-11e9-80e1-6805ca44419c',
	        '7f805c12-d3a3-11e9-80e1-6805ca44419c',
	        '7fa11dc3-d867-11e9-80e1-6805ca44419c',
	        '84451c6b-d62b-11e9-80e1-6805ca44419c',
	        '846046b9-d2e3-11e9-80e1-6805ca44419c',
	        '84b06429-d864-11e9-80e1-6805ca44419c',
	        '870191c2-d54d-11e9-80e1-6805ca44419c',
	        '8a74967c-d540-11e9-80e1-6805ca44419c',
	        '8e354124-d54a-11e9-80e1-6805ca44419c',
	        '8fded8d6-aeb2-11e9-80e1-6805ca44419c',
	        '90556586-d072-11e9-80e1-6805ca44419c',
	        '90bc3e40-d2e8-11e9-80e1-6805ca44419c',
	        '94926d95-d2dc-11e9-80e1-6805ca44419c',
	        '9628a192-d2e0-11e9-80e1-6805ca44419c',
	        '99d9282a-d2e7-11e9-80e1-6805ca44419c',
	        '9b9b98ac-caea-11e9-80e1-6805ca44419c',
	        '9ff3a95c-d0a8-11e9-80e1-6805ca44419c',
	        'a9b2342d-caeb-11e9-80e1-6805ca44419c',
	        'aa5fdcb3-d2da-11e9-80e1-6805ca44419c',
	        'ad33f2a4-d867-11e9-80e1-6805ca44419c',
	        'af1d4ff9-d54a-11e9-80e1-6805ca44419c',
	        'b0e200a4-d2dd-11e9-80e1-6805ca44419c',
	        'b0fb1b95-d3a7-11e9-80e1-6805ca44419c',
	        'b4e95833-d2e3-11e9-80e1-6805ca44419c',
	        'b9d33a3e-d869-11e9-80e1-6805ca44419c',
	        'bbf6f9a4-caea-11e9-80e1-6805ca44419c',
	        'bf742b8a-d2dc-11e9-80e1-6805ca44419c',
	        'c2e7c31a-d84c-11e9-80e1-6805ca44419c',
	        'c6c48b7c-aeb2-11e9-80e1-6805ca44419c',
	        'c926c02d-d2de-11e9-80e1-6805ca44419c',
	        'ce80b6e4-d54a-11e9-80e1-6805ca44419c',
	        'd1746e3f-d869-11e9-80e1-6805ca44419c',
	        'd7ac592e-d865-11e9-80e1-6805ca44419c',
	        'd8cbdbac-d2e6-11e9-80e1-6805ca44419c',
	        'dcc17144-caeb-11e9-80e1-6805ca44419c',
	        'de55d63c-d2dd-11e9-80e1-6805ca44419c',
	        'df851535-d2df-11e9-80e1-6805ca44419c',
	        'e0dfb6cd-d549-11e9-80e1-6805ca44419c',
	        'e55166c5-aeb2-11e9-80e1-6805ca44419c',
	        'e57d422d-d869-11e9-80e1-6805ca44419c',
	        'e7d3bdb6-d869-11e9-80e1-6805ca44419c',
	        'e86aba2e-d2dc-11e9-80e1-6805ca44419c',
	        'e9be4a05-d2db-11e9-80e1-6805ca44419c',
	        'ed71ce2c-d0a8-11e9-80e1-6805ca44419c',
	        'ed821ce6-d554-11e9-80e1-6805ca44419c',
	        'f05b83a5-d2e2-11e9-80e1-6805ca44419c',
	        'f1f153b9-d54a-11e9-80e1-6805ca44419c',
	        'f307681d-d2e0-11e9-80e1-6805ca44419c',
	        'f3bbbcf7-caeb-11e9-80e1-6805ca44419c',
	        'fac6caef-d2de-11e9-80e1-6805ca44419c',
	        'fb84e56a-d866-11e9-80e1-6805ca44419c',
	        'fce734f3-d54d-11e9-80e1-6805ca44419c',
	        'fcf0f323-d2dd-11e9-80e1-6805ca44419c',
	        'fd15a788-d84b-11e9-80e1-6805ca44419c',
	        'fe0a843f-d869-11e9-80e1-6805ca44419c'
		);

		SELECT 
		    COUNT(*)
		FROM
		    1C_8_RAW.СвязиКаталоговИнтернетМагазина AS category_product
		        JOIN
		    1C_8_RAW.КаталогиИнтернетМагазина AS category ON category.uid = category_product.КаталогИнтернетМагазина
		        AND category.ПланОбмена = (
					SELECT 
						uid
					FROM
						1C_8_RAW.ПланОбмена
					WHERE
						Наименование = 'korallmicro'
				)
		WHERE
		    category_product.Номенклатура IN (
				'003f2a6a-d2e8-11e9-80e1-6805ca44419c', 
		        '0c3c8cdc-d2e0-11e9-80e1-6805ca44419c',
		        '12151795-d2dc-11e9-80e1-6805ca44419c',
		        '134e6cf4-d2db-11e9-80e1-6805ca44419c',
		        '13d9260a-d2dd-11e9-80e1-6805ca44419c',
		        '16fd532e-d60b-11e9-80e1-6805ca44419c',
		        '1786006a-d49b-11e9-80e1-6805ca44419c',
		        '1c2beb13-d555-11e9-80e1-6805ca44419c',
		        '1fbaa7ac-d2de-11e9-80e1-6805ca44419c',
		        '1fe3f2af-d867-11e9-80e1-6805ca44419c',
		        '223175d4-d62b-11e9-80e1-6805ca44419c',
		        '223198d2-d0a8-11e9-80e1-6805ca44419c',
		        '27192ceb-d546-11e9-80e1-6805ca44419c',
		        '28922d8d-d2e7-11e9-80e1-6805ca44419c',
		        '2a1c9abc-d866-11e9-80e1-6805ca44419c',
		        '2a80f15d-caeb-11e9-80e1-6805ca44419c',
		        '317e730e-d867-11e9-80e1-6805ca44419c',
		        '36d9443e-d2db-11e9-80e1-6805ca44419c',
		        '3727e2c6-d0a9-11e9-80e1-6805ca44419c',
		        '3a350ddd-d2dc-11e9-80e1-6805ca44419c',
		        '3c7771a7-d84c-11e9-80e1-6805ca44419c',
		        '3f4efffd-bf39-11e9-80e1-6805ca44419c',
		        '4129f39e-d2e6-11e9-80e1-6805ca44419c',
		        '41d5d871-caeb-11e9-80e1-6805ca44419c',
		        '43a894ef-d62b-11e9-80e1-6805ca44419c',
		        '4e569507-d2e0-11e9-80e1-6805ca44419c',
		        '4e584b86-d2e8-11e9-80e1-6805ca44419c',
		        '4fdd31c4-d2de-11e9-80e1-6805ca44419c',
		        '4ff6f7f7-caeb-11e9-80e1-6805ca44419c',
		        '51446b50-d540-11e9-80e1-6805ca44419c',
		        '53bff3bf-d546-11e9-80e1-6805ca44419c',
		        '55091eb6-d541-11e9-80e1-6805ca44419c',
		        '57175c6c-d2e3-11e9-80e1-6805ca44419c',
		        '572f88fe-d86a-11e9-80e1-6805ca44419c',
		        '5c07f811-d867-11e9-80e1-6805ca44419c',
		        '5d234285-d2e5-11e9-80e1-6805ca44419c',
		        '61073379-d2dc-11e9-80e1-6805ca44419c',
		        '61cbb306-d2db-11e9-80e1-6805ca44419c',
		        '65ffd60d-d62b-11e9-80e1-6805ca44419c',
		        '6626974f-caeb-11e9-80e1-6805ca44419c',
		        '664498b1-d84c-11e9-80e1-6805ca44419c',
		        '6774a794-d54e-11e9-80e1-6805ca44419c',
		        '697774ff-d499-11e9-80e1-6805ca44419c',
		        '697fe310-d073-11e9-80e1-6805ca44419c',
		        '6a73d0e2-d540-11e9-80e1-6805ca44419c',
		        '6ccb5c50-d3c6-11e9-80e1-6805ca44419c',
		        '6cffa011-aeb2-11e9-80e1-6805ca44419c',
		        '7a0291ca-d2de-11e9-80e1-6805ca44419c',
		        '7d9deac8-d541-11e9-80e1-6805ca44419c',
		        '7e5ba064-caeb-11e9-80e1-6805ca44419c',
		        '7f805c12-d3a3-11e9-80e1-6805ca44419c',
		        '7fa11dc3-d867-11e9-80e1-6805ca44419c',
		        '84451c6b-d62b-11e9-80e1-6805ca44419c',
		        '846046b9-d2e3-11e9-80e1-6805ca44419c',
		        '84b06429-d864-11e9-80e1-6805ca44419c',
		        '870191c2-d54d-11e9-80e1-6805ca44419c',
		        '8a74967c-d540-11e9-80e1-6805ca44419c',
		        '8e354124-d54a-11e9-80e1-6805ca44419c',
		        '8fded8d6-aeb2-11e9-80e1-6805ca44419c',
		        '90556586-d072-11e9-80e1-6805ca44419c',
		        '90bc3e40-d2e8-11e9-80e1-6805ca44419c',
		        '94926d95-d2dc-11e9-80e1-6805ca44419c',
		        '9628a192-d2e0-11e9-80e1-6805ca44419c',
		        '99d9282a-d2e7-11e9-80e1-6805ca44419c',
		        '9b9b98ac-caea-11e9-80e1-6805ca44419c',
		        '9ff3a95c-d0a8-11e9-80e1-6805ca44419c',
		        'a9b2342d-caeb-11e9-80e1-6805ca44419c',
		        'aa5fdcb3-d2da-11e9-80e1-6805ca44419c',
		        'ad33f2a4-d867-11e9-80e1-6805ca44419c',
		        'af1d4ff9-d54a-11e9-80e1-6805ca44419c',
		        'b0e200a4-d2dd-11e9-80e1-6805ca44419c',
		        'b0fb1b95-d3a7-11e9-80e1-6805ca44419c',
		        'b4e95833-d2e3-11e9-80e1-6805ca44419c',
		        'b9d33a3e-d869-11e9-80e1-6805ca44419c',
		        'bbf6f9a4-caea-11e9-80e1-6805ca44419c',
		        'bf742b8a-d2dc-11e9-80e1-6805ca44419c',
		        'c2e7c31a-d84c-11e9-80e1-6805ca44419c',
		        'c6c48b7c-aeb2-11e9-80e1-6805ca44419c',
		        'c926c02d-d2de-11e9-80e1-6805ca44419c',
		        'ce80b6e4-d54a-11e9-80e1-6805ca44419c',
		        'd1746e3f-d869-11e9-80e1-6805ca44419c',
		        'd7ac592e-d865-11e9-80e1-6805ca44419c',
		        'd8cbdbac-d2e6-11e9-80e1-6805ca44419c',
		        'dcc17144-caeb-11e9-80e1-6805ca44419c',
		        'de55d63c-d2dd-11e9-80e1-6805ca44419c',
		        'df851535-d2df-11e9-80e1-6805ca44419c',
		        'e0dfb6cd-d549-11e9-80e1-6805ca44419c',
		        'e55166c5-aeb2-11e9-80e1-6805ca44419c',
		        'e57d422d-d869-11e9-80e1-6805ca44419c',
		        'e7d3bdb6-d869-11e9-80e1-6805ca44419c',
		        'e86aba2e-d2dc-11e9-80e1-6805ca44419c',
		        'e9be4a05-d2db-11e9-80e1-6805ca44419c',
		        'ed71ce2c-d0a8-11e9-80e1-6805ca44419c',
		        'ed821ce6-d554-11e9-80e1-6805ca44419c',
		        'f05b83a5-d2e2-11e9-80e1-6805ca44419c',
		        'f1f153b9-d54a-11e9-80e1-6805ca44419c',
		        'f307681d-d2e0-11e9-80e1-6805ca44419c',
		        'f3bbbcf7-caeb-11e9-80e1-6805ca44419c',
		        'fac6caef-d2de-11e9-80e1-6805ca44419c',
		        'fb84e56a-d866-11e9-80e1-6805ca44419c',
		        'fce734f3-d54d-11e9-80e1-6805ca44419c',
		        'fcf0f323-d2dd-11e9-80e1-6805ca44419c',
		        'fd15a788-d84b-11e9-80e1-6805ca44419c',
		        'fe0a843f-d869-11e9-80e1-6805ca44419c'
			);

	Тоже самое сделаем в magic

Проверим цены и остатки по этим продуктам


--------


Мебель

	18 августа 2014 г. 14:31
	20 октября 2014 г. 12:16
	21 октября 2014 г. 23:02

	Офисные кресла и стулья

		2 июня 2014 г. 14:07
		18 августа 2014 г. 12:44
		18 августа 2014 г. 12:57
		19 октября 2014 г. 23:47

		Кресла для персонала и посетителей

			24 августа 2015 г. 15:23
			15 сентября 2015 г. 16:38
			23 сентября 2015 г. 9:51
			30 сентября 2015 г. 11:04
			21 октября 2015 г. 13:45
			21 октября 2015 г. 13:49
			2 ноября 2015 г. 12:40
			4 ноября 2015 г. 9:21
			4 ноября 2015 г. 9:21


По поводу проблемы "у каталога в котором находится товар не стоит галочка приоритетная группа", а до этого стояла" нашел вот что:


1. Галочка "приоритетная группа" ставится только в magic в разделе "Каталоги" и в фоновой задаче.

2. Если у родительского каталога убрать или добавить галочку "приоритетная группа", то и в дочерних каталогах она изменится.

3. Если у каталога в 1с родитель = '00000000-0000-0000-0000-000000000000', то в фоновой задаче галочка сбросится.

4. Если у каталога в 1с есть родитель, то значение галочки будет браться из magic.



Возможная причина снятия галочки.

Условие: 

- есть каталог "Мебель", в него вложен каталог "Офисные кресла и стулья", а в него каталог "Кресла для персонала и посетителей".

Цепочка действий:

- первый редактирует каталог верхнего уровня "мебель" и сохраняет без галочки

- галочка сбрасывается во всех вложенных каталогах

- второй редактирует вложенный каталог "Офисные кресла и стулья" и ставит там галочку

- теперь эта галочка появляется и в каталоге "Кресла для персонала и посетителей", потому что он вложенный, но не появляется в каталоге верхнего уровня "мебель", потому что так работает код 

- первый опять редактирует каталог верхнего уровня "мебель" и сохраняет без галочки

- галочка сбрасывается во всех вложенных каталогов

Проблема:

- нет истории о том, как, кто и в каком состояние сохранял каталог

Вывод:

- моя гипотеза о причине под сомнение, но и гипотеза о том, что кто то 100% сохранил с галочкой, тоже под сомнением

Варианты решения:

- вешаем валидацию на галочку "приоритетная группа" и переписываем логику установки этой галочки для вложенных групп.


Вопрос: когда у каталога в 1с может быть родитель = '00000000-0000-0000-0000-000000000000'?

	Полностью нулевой идентификатор в 1С означает «пустую ссылку», то есть не заполненное значение указанного типа.

	В рамках Каталогов интернет-магазина это значит, что у Каталога не заполнен родитель, то есть это каталог верхнего уровня.