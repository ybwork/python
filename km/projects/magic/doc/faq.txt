Оглавление

	Галочка "Не для интернет магазина"

	Кол-во распределенного товара вне диапозона

	Бесконечный цикл при создании каталогов

	Проблема с выгодными предложениями

	Проблема с количеством товара на сайте

Галочка "Не для интернет магазина"

	В 1с товару поставили галочку "Не для интернет магазина", но он всеравно отображается на сайте

		Причина: потому что товар отвязан от категории в 1c. Смотреть в разделе "Иерархия групп объектов обмена".

		На 4.09.19 если в 1с стоит галочка "Не для интернет магазина", то это значит, что продукт не должен быть на сайтах korallmicro и istore.

		Если говорить в терминах 1с, то номеклатура не имеет связи с каталогом.

		Для того, чтобы исправить ситуацию нужно:

			привязать номенклатуру к каталогу в 1с

			найти в бд magic лишние связи товара с категорией для сайтов korallmicro и istore:

				SELECT
				    c_c.id,
				    c_c.type
				FROM
				    magic.catalog_distributions c_d
				        LEFT JOIN
				    magic.catalog_catalog c_c ON c_d.catalog_id = c_c.id
				WHERE
				    product_id = 1987
				        AND c_c.type IN ('korallmicro' , 'istore');

			удаляем из бд magic лишние связи товара с категорией для сайтов korallmicro и istore:

				DELETE FROM
				    magic.catalog_distributions
				WHERE
				    product_id = 1987
				        AND catalog_id IN (281904, 319023)

			ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

		Если не помогло, то:

			просим ответственного за проект убрать у продукта в 1с галочку "Не для интернет магазина"

			ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

			просим ответственного за проект вернуть продукту в 1с галочку "Не для интернет магазина"

			ждем пока пройдет полная синхронизаци magic с 1с и сбросится кэш

Кол-во распределенного товара вне диапозона

	Ошибка при синхронизации с 1с "Кол-во распределенного товара вне диапозона".

		Причина: потому что кол-во продуктов в 1с сильно отличается от кол-ва продуктов в magic.

		Если ответственный за проект много работал в 1с с продуктами, то это нормальная ситуация.

		Для решения проблемы нужно связаться с ответственным за проект и узнать работал ли он с продуктами и каталогами в 1с. 

			Если работал, то просим у ответсвенного за проект разрешения на "синхронизацию без доверительного интервала".

			Если разрешает, то:

				находим на рабочей почте письмо об ошибке и смотрим для какого магазина она произошла (snr, korallmicro, istore)

					Task was called with args: [] kwargs: {u'shop_type': u'korallmicro'}

					Это говорит, что ошибка произошла при синхронизации для korallmicro

				в 1-ой консоле заходим на боевой magic

					ssh devel@192.168.7.76

					открываем файл с логами, выполняющихся фоновых задач

						tail -f ~/log/magic-celery-system.txt

				во 2-ой консоле заходим на боевой magic

					ssh devel@192.168.7.76

					переходим в корень проекта

						cd ~/www/magic

					смотрим в открытый файл с логами выполняющихся фоновых задач и убеждаемся, что нет запущенных sync_shop

					выполняем синхронизацию для нужного магазина вручную и без сравнения кол-ва товаров

						bin/celery call -A app_celery sync_shop --queue=system --args='["название нужного магазина, например istore", false]'

		Если ответсвенного за проект не разрешает выполнить "синхронизацию без доверительного интервала", то исследуем код и ищем проблему.

			открываем /magic/modules/catalog/tasks.py

			ищем там if use_confidence_interval

			разбираемся

Бесконечный цикл при создании каталогов

	Ошибка при синхронизации с 1с "Бесконечный цикл при создании каталогов".

		Причина: потому что в 1с помеченный "на удаление" каталог, не удаляется из базы 1c_8_raw.

		Смотреть разницу между интерфейсом 1с и базой 1c_8_raw.

			В 1с каталоги будут помечены на удаление, а в 1c_8_raw в поле _ПометкаУдаление будет стоять 0.

			Можно посмотреть с помощью следующего запроса:

				SELECT 
					* 
				FROM 
					1C_8_RAW.КаталогиИнтернетМагазина
				WHERE 
					uid = 'сюда подставляем uid каталога на котором валится скрипт, например 61862fdd-f59c-11e1-82bc-002655df3ac1';

		Для решения проблемы нужно обратиться в сектор 1с и попросить полностью перезалить бд 1c_8_raw.

Проблема с выгодными предложениями

	После изменений выгодных предложений они не отображаются на сайтах (korallmicro, snr, istore).

	Причина: потому что падает синхронизация magic с 1с.

	Для решения проблемы:

		узнаем у сообщивших о проблеме, что именно они меняли и где это должно быть на сайтах.

		заходим на боевой magic

			ssh devel@192.168.7.76

			переходим в корень проекта

				cd ~/www/magic

			открываем shell

				bin/manage shell

			запускаем синхронизацию выгодных предложений вручную

				from catalog.tasks import *

				from snr.tasks import *

				sync_offers_korallmicro.delay()

				sync_korallmicro.delay()

				sync_offers_snr.delay()

				sync.delay(site_models='sales_base_models.models', shop_type='snr_new')

		ждем пока закончатся фоновые задачи и обновится кэш

		проверяем, что изменения вступили в силу

Пересекающиеся товары в выгодных предложениях

	Причина: обе акции активны.

	Каждой акции задается время действия.

	Если в акциях есть одинаковые товары и они обе активны, то товары будут пересекаться и это нормально.

	Поэтому первым делом нужно узнать у того, кто написал о проблеме о каких акциях идет речь и проверить в срок действия этих акций.

		заходим в раздел с акциями

			http://magic.km-union.ru/catalog/offers/

		выбираем нужный интернет магазин

		справа в колонке "Типы выгодных предложений" подгрузятся все выгодные предложения этого магазина

		находим и нажимаем на нужное выгодное предложение

		скролим в самый низ и ищём колонку "Выгодные предложения"

		в колонку "Выгодные предложения" должно подгрузиться срок действия выгодного предложения

	Если обе акции активны и вних есть одинаковые товары, то они будут пересекаться. Это нормально поведение.

	Доносим эту мысль человеку, который сообщил об ошибке.

Проблема с количеством товара на сайте

	На 23.09.19

		1с продукты

			25047

		Magic карточки товара

			ProductCard.objects.filter(
				date_formed_description__isnull=False
			).exclude(
				code__exact=None
			).get_checked().get_actual().get_verified().count()
			
				22512

			------

			SELECT
			    `cards_productcard`.`code`
			FROM
			    magic.`cards_productcard`
			        LEFT OUTER JOIN
			    magic.`cards_productcardimage` ON (`cards_productcard`.`id` = `cards_productcardimage`.`card_id`)
			        INNER JOIN
			    magic.`cards_kind` ON (`cards_productcard`.`kind_id` = `cards_kind`.`id`)
			        INNER JOIN
			    magic.`cards_property` ON (`cards_kind`.`id` = `cards_property`.`kind_id`)
			WHERE
			    (NOT (`cards_productcard`.`code` IS NULL)
			        AND `cards_productcard`.`is_checked` = TRUE
			        AND `cards_productcard`.`is_actual` = TRUE
			        AND `cards_productcard`.`is_actual` = TRUE
			        AND `cards_productcard`.`brand_id` IS NOT NULL
			        AND `cards_productcard`.`code` IS NOT NULL
			        AND `cards_productcard`.`has_invalid_images` = FALSE
			        AND `cards_productcard`.`is_ready` = TRUE
			        AND `cards_productcard`.`is_checked` = TRUE
			        AND `cards_property`.`id` IS NOT NULL
			        AND `cards_productcard`.`date_formed_description` IS NOT NULL)
			GROUP BY `cards_productcard`.`id`
			HAVING COUNT(`cards_productcardimage`.`id`) > 0
			ORDER BY `cards_productcard`.`code` ASC

		korallmicro продукты

			select 
				count(*) 
			from public.products

				23100

		korallmicro продукты с published = true

			select 
				count(*) 
			from 
				public.products
			where
				published = true

				19927

		korallmicro продукты с published = false

			select 
				count(*)
			from 
				public.products
			where
				published = false

				3173

		карточки товара в magic из тех, что published = false на коралле

			SELECT 
			    count(*)
			FROM
			    magic.cards_productcard
			WHERE
			    code IN (
			    	86 , 
			    	249,
			        251
			        ...
			    )

			    609

		карточки товара в magic из тех, что published = false на коралле, которые полностью валидны

			SELECT
				cards_productcard.code 
			FROM
				magic.cards_productcard
					LEFT OUTER JOIN
				magic.cards_productcardimage ON cards_productcard.id = cards_productcardimage.card_id
					INNER JOIN
				magic.cards_kind ON cards_productcard.kind_id = cards_kind.id
					INNER JOIN
				magic.cards_property ON cards_kind.id = cards_property.kind_id
			WHERE
				cards_productcard.code IN (
					86,
					249,
					251,
					...
				)
				AND cards_productcard.is_checked = TRUE
				AND cards_productcard.is_actual = TRUE
				AND cards_productcard.brand_id IS NOT NULL
				AND cards_productcard.code IS NOT NULL
				AND cards_productcard.has_invalid_images = FALSE
				AND cards_productcard.is_ready = TRUE
				AND cards_productcard.is_checked = TRUE
				AND cards_property.id IS NOT NULL
				AND cards_productcard.date_formed_description IS NOT NULL
			GROUP BY cards_productcard.id
			HAVING COUNT(cards_productcardimage.id) > 0
			ORDER BY cards_productcard.code ASC

				0

		korallmicro цены

			SELECT
			    distinct
			    count(*)
			FROM
			    public.prices
			WHERE
			    pid IN (
			        select 
			            id 
			        from 
			            public.products
			        where
			            published = false
			    )

			    565

		korallmicro остатки

			SELECT
			    distinct
			    count(*)
			FROM
			    public.remains
			WHERE
			    pid IN (
			        select 
			            id 
			        from 
			            public.products
			        where
			            published = false
			    )

			    0

	Описание проблемы

		На сайтах korallmicro, snr и istore должно быть больше товаров чем есть на данный момент.

		Особые проблемы наблюдаются в разделе новинки.

		Также ежедневно общее кол-во товаров на сайтах уменьшается.

	Термины

		номенклатура == продукт

		каталог == категория

		СвязиКаталоговИнтернетМагазина == связь продукта с категорией  == catalog_distributions (magic)

	Синхронизация

		В процессе от создания до появления продукта на сайте участвуют системы 1с, magic, dp, sdp.

		Процесс выгрузки данных из одной системы в другую называется синхронизация.

		В целом синхронизация работает так:

			Данные появляются в 1с.

			Из 1с данные выгружаются в бд 1c_8_raw.

			Из 1c_8_raw данные выгружаются в magic.

			Из magic данные попадают на сайты.

			Dp проставляет цены и остатки продуктам, которые попали на сайты.

	Условия 1с при которых номенклатура должна попасть на сайт

		Не стоят галочки "НеДляПродажи", "НеДляРозницы", "_ПометкаУдаления".

		Создан минимум 12 часов назад.

		Привязан к каталогу.

		Правильно заданы вид-подвид (в названии регистр имеет значение).

		Правильно заданы правила распределения.

	Условия magic при которых продукт должен попасть на сайт

		После синхронизации с 1с продукт появился в magic и он привязан к каталогу нужного сайта.

		У каталога к которому привязан продукт стоит галочка "Приоритетная группа". 

		Созданна карточка товара с таким же кодом, как и продукта.

		Карточка товара имеет код, бренд, вид-тип, валидные картинки, заполненное поле "date_formed_description", статус "актуальна", слепок, готова к проверке, проверена.

	Условия dp при которых продукту должны проставиться цены и остатки

		...

	Условия сайта при которых продукт должен отображаться

		Продукт попал в базу сайта.

		Продукт связан с каталогом.

		У каталога к которому привязан продукт стоит галочка "Приоритетная группа".

		У продукта есть остатки и цены.

	На 17.08.19 проблемы на этапах:

		1c

			косяк с вид-подвид в распределении.

		новинки на коралле

			у каталога в котором находится товар не стоит галочка "приоритетная группа", а до этого стояла.

				231367

				/catalog/catalog/281727/change/

				Если у любого родительского каталога убрать галочку "приоритетная группа", то у вложенных она тоже исчезнет

				    def set_priority_group(self):
				        """Устанавливает новое значение атрибута is_priority_group для
				        записи и всех ее вложенных записей.

				        """
				        self.children.all().update(is_priority_group=self.is_priority_group)
				        for nested in self.children.all():
				            nested.set_priority_group()

				В таске sync_shop модуля каталог is_priority_group берется из magic

			+ все везде есть и всеравно товар не появляется в новинках

				232483
				
				нет остатков

		magic

			в 1С в виде-подвиде "смартфон-запчасть" (то есть в правилах распределения задано неправильно, а в magic все правильно - "смартфон-смартфон" и на сайте тоже в смартфонах.

				Cмартфон

					198186

		dp

			проблемы с синхронизацией цен и остатков.

	Изначально продукты создаются в 1с.

	Из 1с продукты выгружаются в бд 1c_8_raw.

	Из бд 1c_8_raw продукты выгружаются в бд magic, таблица ones_products.

	Из таблицы ones_products продукты выгружаются в catalog_products, catalog_catalog и создаются связи в catalog_distributions согласно правилам из catalog_rules.

	Из бд magic продукты попадают в бд конкретных сайтов (korallmicro, snr, istore).

	Условия по которым продукт считается пригодным для выгрузки:

		СнятаСПродажи = 0/1

		НеДляПродажи = 0

		НеДляРозницы = 0

		_ПометкаУдаления = 0

		# созданные минимум 12 часов назад
		ДатаСоздания <= date_add(now(),interval -12 hour)

	Из 1с в magic идет выгрузка в таблицы из модуля ones в таске sync_db.

	Затем для каждого магазина запускается таск sync_shop.

	Внутри таска sync_shop сначала идет распределение продуктов в magic по таблицам catalog_products, catalog_catalog и catalog_distributions c помощью метода sync, а затем уже в бд конкретного магазина.

	Korallmicro

		Выгрузка товаров из 1с в 1c_8_raw

			SELECT 
				COUNT(*)
			FROM 
				1C_8_RAW.Номенклатура
			WHERE
				uid IN (
					SELECT 
						Номенклатура
					FROM
						1C_8_RAW.СвязиКаталоговИнтернетМагазина
					WHERE
						КаталогИнтернетМагазина IN (
							SELECT
								uid
							FROM
								1C_8_RAW.КаталогиИнтернетМагазина
							WHERE
								ПланОбмена = (
									SELECT 
										uid
									FROM 
										1C_8_RAW.ПланОбмена
									WHERE
										Наименование = 'Korallmicro'
								)
							AND
								_ПометкаУдаления = 0
						)
				)
			AND
				НеДляПродажи = 0
			AND
				НеДляРозницы = 0
			AND
				_ПометкаУдаления = 0
			AND
				ДатаСоздания <= date_add(now(),interval -12 hour);

			>>> 25101

		Выгрузка товаров из 1c_8_raw в magic

			SELECT
				COUNT(*)
			FROM
				magic.catalog_products as p
			JOIN
				magic.catalog_distributions as d
			ON
				d.product_id = p.code
			JOIN
				magic.catalog_catalog as c
			ON
				c.id = d.catalog_id
			WHERE
				c.type = 'korallmicro';

			>>> 23202

		Те у которых нет связи с каталогом korallmicro

			SELECT 
				COUNT(*)
			FROM 
				1C_8_RAW.Номенклатура
			WHERE
				uid IN (
					SELECT 
						Номенклатура
					FROM
						1C_8_RAW.СвязиКаталоговИнтернетМагазина
					WHERE
						КаталогИнтернетМагазина IN (
							SELECT
								uid
							FROM
								1C_8_RAW.КаталогиИнтернетМагазина
							WHERE
								ПланОбмена = (
									SELECT 
										uid
									FROM 
										1C_8_RAW.ПланОбмена
									WHERE
										Наименование = 'Korallmicro'
								)
							AND
								_ПометкаУдаления = 0
						)
				)
			AND
				НеДляПродажи = 0
			AND
				НеДляРозницы = 0
			AND
				_ПометкаУдаления = 0
			AND
				ДатаСоздания <= date_add(now(),interval -12 hour)
			AND
				Код NOT IN (
					SELECT
						p.code
					FROM
						magic.catalog_products as p
					JOIN
						magic.catalog_distributions as d
					ON
						d.product_id = p.code
					JOIN
						magic.catalog_catalog as c
					ON
						c.id = d.catalog_id
					WHERE
						c.type = 'korallmicro'
				)
			ORDER BY ДатаСоздания DESC

			>>> 1943

		Провереям, что у 1943 продуктов нет связи с каталогом korallmicro, а должна быть

			SELECT 
			    p.code, c.type
			FROM
			    magic.catalog_products AS p
			        JOIN
			    magic.catalog_distributions AS d ON d.product_id = p.code
			        JOIN
			    magic.catalog_catalog AS c ON c.id = d.catalog_id
			WHERE
			    p.code IN (
			        219587,
			        203907
			    );

		Провереям, что у 1943 продуктов есть связи с каталогом korallmicro в 1с_8_raw

			SELECT
				count(*)
				product.Код,
				category_product.КаталогИнтернетМагазина
			FROM
			    1C_8_RAW.Номенклатура AS product
			        JOIN
			    1C_8_RAW.СвязиКаталоговИнтернетМагазина AS category_product ON category_product.Номенклатура = product.uid
					JOIN
				1C_8_RAW.КаталогиИнтернетМагазина AS category ON category.uid = category_product.КаталогИнтернетМагазина
			WHERE
				category.ПланОбмена = (
					SELECT
						plan.uid
					FROM
						1C_8_RAW.ПланОбмена AS plan
					WHERE
						plan.Наименование = 'korallmicro'
				)
				AND
					product.Код IN (
						213787, 
						206999,
					);

		Смотрим продукт 1с - magic

			SELECT 
			    *
			FROM
			    1C_8_RAW.Номенклатура
			WHERE
				Код = 184512;

			------

			SELECT 
			    *
			FROM
			    magic.catalog_products
			WHERE
			    code = 213787;

		Смотрим связь продукта с категорией 1с - magic

			SELECT 
			    *
			FROM
			    1C_8_RAW.СвязиКаталоговИнтернетМагазина
			WHERE
				Номенклатура = '33ebd596-a479-11e9-80e1-6805ca44419c';

			------

			SELECT 
			    *
			FROM
			    magic.catalog_distributions
			WHERE
			    product_id = 213787;

		Смотрим категории 1с - magic

			SELECT 
			    КаталогиИнтернетМагазина.uid,
			    КаталогиИнтернетМагазина.Наименование,
			    ПланОбмена.Наименование
			FROM
			    1C_8_RAW.КаталогиИнтернетМагазина
			        JOIN
			    1C_8_RAW.ПланОбмена ON КаталогиИнтернетМагазина.ПланОбмена = ПланОбмена.uid
			WHERE
			    КаталогиИнтернетМагазина.uid IN (
					'61863006-f59c-11e1-82bc-002655df3ac1',
			        '801059df-1fbd-11e9-80d9-6805ca44419c',
			        'bd15d28a-2714-11e5-80d9-001b21d8d330',
			        'd155349c-fd61-11e5-93f9-001b21d8d330'
				);

			-------

			SELECT
				full_name,
				type
			FROM
				magic.catalog_catalog
			WHERE
				id IN (318290);

		Смотрим наличие карточки товара в magic и стоит ли date_formed_description

			SELECT 
			    *
			FROM
			    magic.cards_productcard
			WHERE
				code = 213787;

		Смотрим есть ли слепок карточки товара

			SELECT 
			    *
			FROM
			    magic.cards_productcarddescription
			WHERE
				card_id = 60627;

		Смотрим остатки 1с - dp

			SELECT 
			    *
			FROM
			    1C_8_RAW.Остатки
			WHERE
			    Номенклатура = '0978b6c9-cbb4-11e8-80d7-6805ca44419c';

			------

			SELECT 
				* 
			FROM 
				public.remains 
			WHERE 
				pid=197416;

			------

			from sales_base_models.models import * 

			Remains.objects.filter(sid=Site.objects.get(subdomain='www').pk, pid=184512)

		Смотрим наличие цены 1с - dp

			SELECT 
			    *
			FROM
			    1C_8_RAW.Цены
			WHERE
			    Номенклатура = '21609ef0-3b93-11e7-80c7-6805ca44419c';

			------

			SELECT 
				*  
			FROM 
				public.prices 
			WHERE 
				pid=197416;

			------

			from sales_base_models.models import * 

			Prices.objects.filter(sid=Site.objects.get(subdomain='www').pk, pid=184512)

		Смотрим наличие продукта в базе магазина

			SELECT 
				* 
			FROM 
				public.products 
			WHERE 
				id=197416;

		Вид-тип-бренд и каталог

			Нет нужной связи в catalog_distributions и она не может сформироваться, потому что product_uuids = get_product_uuids_for_sale, не берет нужный продукт из-за отсутсвия нужной связи вид-типа-бренда и каталога

				SELECT 
				    *
				FROM
				    magic.catalog_rules;

			Где взять vtb_id

				SELECT 
				    vtb_id
				FROM
				    magic.ones_products
				WHERE
					code = 225550;

			Цепочка

				184512, 228869, 197416

					Номенклатура

						Нет пометок

						SELECT 
						    *
						FROM
						    1C_8_RAW.Номенклатура
						WHERE
							Код = 197416;

					Распределение каталогов сайтов

						"Иерархия объектов обмена"

						Не указал папку

						Не указал правильный вид-подвид

						Вид-подвид не соответсвовал группе

						Папка и бери из неё все

					Мэджик каталоги

						Если видит, то супер

					Мэджик карточка

						Фото, валидация

					В dp "цены и остатки"

						korallmicro

						поиск по всем каталогам

						смотрю папку в иерархии dp

						есть тип цены, но он не влияет на выгрузку

							инэт магаз

							по акции

							ррц рекомендуемая розничная цена производителя

					Закупка кладет товар в папку

						"Если решили переложить в другую папку, то он просто пропадает"

-------

string 'getProducts' (length=11)
array (size=1)
 'where' =>
   array (size=4)
     0 => string '"product"."id" not in (select "pid" from "disabled" where "sid" = 49 and "gid" is null)' (length=87)
     1 => string 'product.id in (select "pid" from "distributions" where "gid" in (select "gid" from "catalogs" where "is_priority_group" is true))' (length=129)
     2 => string '"product"."new" is true' (length=23)
     3 => string '"remain"."km_value" + "remain"."dealer_value" +  "remain"."transit_value"> 0' (length=76)
Array ( [where] => Array ( [0] => "product"."id" not in (select "pid" from "disabled" where "sid" = 49 and "gid" is null) [1] => product.id in (select "pid" from "distributions" where "gid" in (select "gid" from "catalogs" where "is_priority_group" is true)) [2] => "product"."new" is true [3] => "remain"."km_value" + "remain"."dealer_value" + "remain"."transit_value"> 0 ) )

---------

select * from public.products where id = 231367;

select * from public.distributions where pid = 231367;

select * from public.catalogs where gid = 281727;

select * from public.remains where pid = 281727;

	если остатков нет, то нет записи

select * from public.prices where pid = 281727;


---------


Коды продуктов проведенных за определенный срок

	from cards.models import *

	list(
		ProductCard.objects.filter(
			date_checked__gte=datetime(2019, 9, 18), date_formed_description__isnull=False
		).values_list(
			'code', 
			flat=True
		)
	)

Получим все uid продуктов

	SELECT 
	    uid
	FROM
	    1C_8_RAW.Номенклатура
	WHERE
	    Код IN (229630 , 229631,
	        229633,
	        229634,
	        ...
	    );

Проверим, что каждый привязан к каталогу коралла и он не помечен на удаление

	SELECT 
	    *
	FROM
	    1C_8_RAW.СвязиКаталоговИнтернетМагазина AS category_product
	WHERE
	    category_product.Номенклатура IN (
			'003f2a6a-d2e8-11e9-80e1-6805ca44419c', 
	        '0c3c8cdc-d2e0-11e9-80e1-6805ca44419c'
	        ...
		);

		SELECT 
		    COUNT(*)
		FROM
		    1C_8_RAW.СвязиКаталоговИнтернетМагазина AS category_product
		        JOIN
		    1C_8_RAW.КаталогиИнтернетМагазина AS category ON category.uid = category_product.КаталогИнтернетМагазина
		        AND category.ПланОбмена = (
					SELECT 
						uid
					FROM
						1C_8_RAW.ПланОбмена
					WHERE
						Наименование = 'korallmicro'
				)
		WHERE
		    category_product.Номенклатура IN (
				'003f2a6a-d2e8-11e9-80e1-6805ca44419c', 
		        '0c3c8cdc-d2e0-11e9-80e1-6805ca44419c'
		        ...
			);

	Тоже самое сделаем в magic

Проверим цены и остатки по этим продуктам


--------


Мебель

	18 августа 2014 г. 14:31
	20 октября 2014 г. 12:16
	21 октября 2014 г. 23:02

	Офисные кресла и стулья

		2 июня 2014 г. 14:07
		18 августа 2014 г. 12:44
		18 августа 2014 г. 12:57
		19 октября 2014 г. 23:47

		Кресла для персонала и посетителей

			24 августа 2015 г. 15:23
			15 сентября 2015 г. 16:38
			23 сентября 2015 г. 9:51
			30 сентября 2015 г. 11:04
			21 октября 2015 г. 13:45
			21 октября 2015 г. 13:49
			2 ноября 2015 г. 12:40
			4 ноября 2015 г. 9:21
			4 ноября 2015 г. 9:21


По поводу проблемы "у каталога в котором находится товар не стоит галочка приоритетная группа", а до этого стояла" нашел вот что:


1. Галочка "приоритетная группа" ставится только в magic в разделе "Каталоги" и в фоновой задаче.

2. Если у родительского каталога убрать или добавить галочку "приоритетная группа", то и в дочерних каталогах она изменится.

3. Если у каталога в 1с родитель = '00000000-0000-0000-0000-000000000000', то в фоновой задаче галочка сбросится.

4. Если у каталога в 1с есть родитель, то значение галочки будет браться из magic.



Возможная причина снятия галочки.

Условие: 

- есть каталог "Мебель", в него вложен каталог "Офисные кресла и стулья", а в него каталог "Кресла для персонала и посетителей".

Цепочка действий:

- первый редактирует каталог верхнего уровня "мебель" и сохраняет без галочки

- галочка сбрасывается во всех вложенных каталогах

- второй редактирует вложенный каталог "Офисные кресла и стулья" и ставит там галочку

- теперь эта галочка появляется и в каталоге "Кресла для персонала и посетителей", потому что он вложенный, но не появляется в каталоге верхнего уровня "мебель", потому что так работает код 

- первый опять редактирует каталог верхнего уровня "мебель" и сохраняет без галочки

- галочка сбрасывается во всех вложенных каталогов

Проблема:

- нет истории о том, как, кто и в каком состояние сохранял каталог

Вывод:

- моя гипотеза о причине под сомнение, но и гипотеза о том, что кто то 100% сохранил с галочкой, тоже под сомнением

Варианты решения:

- вешаем валидацию на галочку "приоритетная группа" и переписываем логику установки этой галочки для вложенных групп.


Вопрос: когда у каталога в 1с может быть родитель = '00000000-0000-0000-0000-000000000000'?

	Полностью нулевой идентификатор в 1С означает «пустую ссылку», то есть не заполненное значение указанного типа.

	В рамках Каталогов интернет-магазина это значит, что у Каталога не заполнен родитель, то есть это каталог верхнего уровня.