Оглавление

	Что это

	Главный конфигурационный файл

	Глобальная секция

	Секция http

	Секция server

	Docker

	Команды

Что это

	Это веб сервер.

	Веб сервер — это компьютерная программа, запускаемая на подключённом к сети компьютере и использующая протокол HTTP для передачи данных. 

	В простейшем виде такая программа получает по сети HTTP-запрос на определённый ресурс, находит соответствующий файл на локальном жёстком диске и отправляет его по сети запросившему компьютеру. Более сложные веб-серверы способны в ответ на HTTP-запрос динамически генерировать документы с помощью шаблонов и сценариев.

	Для загрузки и просмотра веб-страниц используются специальные программы — браузеры. Браузер это клиент.

Главный конфигурационный файл

	По умолчанию, конфигурационный файл называется nginx.conf и расположен в каталоге /usr/local/nginx/conf, /etc/nginx/conf.d/default.conf или /usr/local/etc/nginx

	Конфигурационный файл NGINX состоит из секций.

Глобальная секция

	В глобальной секции задаются параметры, оказывающие влияние на сервер в целом. 

	Глобальная секция не заключается в фигурные скобки. 

	Обычно пишется в файле nginx.conf

		user  nginx; - пользователь и группа, от имени которых исполняются рабочие процессы (нужно содать пользователя с этим именем в системе)
		worker_processes  1; - кол-во рабочих процессов

		error_log  /var/log/nginx/error.log warn; - файл куда логгируются ошибки
		pid        /var/run/nginx.pid; - файл в котором храниться id главного процесса


	Глобальная секция должна находиться в начале конфигурационного файла nginx.conf

	В главный файл конфигурации можно подключать файлы. Если указан не полный путь, то NGINX считает, что путь задан относительно главного местоположения конфигурационного файла.

		include /etc/nginx/conf.d/*.conf;

Секция http

	Секция http описывает http сервер. Сюда входят настройки соединения с клиентом, работа со статикой, сокетами, виртуальными серверами и т.д.

Секция server

	Секция server описывает виртуальный сервер. По умолчанию секция server находиться в отдельном файле, который подключается в секцию http. Этот файл называется default.conf. Его можно найти в etc/nginx/conf.d/default.conf.

		server {
			listen 80; - порт (если оставить 80, то в браузере будет работать без указания порта)
    		server_name localhost; - ip адрес

		    location / {
		        root   /usr/share/nginx/html; - директория с файлом
		        index  index.html index.htm; - тип и имя файла
		    }
		}

	В секции server описываются виртуальные сервера.

	Виртуальные сервера отвечают на запросы по протоколу HTTP.

	Описание виртуальных серверов обычно выносят в /etc/nginx/sites-available

	Директория с виртуальными серверами подключается внутри секции http.

	Файл с описанием виртуального сервера выглядит так:

		server {
			listen 80;
			server_name www.example.com;

			location / {
				try_files $uri $uri/ @mongrel;
			}

			location @mongrel {
				proxy_pass http://127.0.0.1:8080;
			}
		} 

	В директиве server_name возможно использование метасимвола *

	Метасимвол * можно указывать вместо поддомена: *.example.com

	Метасимвол * можно указывать вместо домена верхнего уровня www.example.*

	В директиве server_name может быть и регулярное выражение.

	Чтобы определить, какой виртуальный сервер должен обслужить данный запрос, NGINX применяется следующий алгоритм:

		Сопоставить IP-адрес и порт с указанными в директиве listen

		Сопоставить заголовок Host со значением директивы server_name, рассматриваемым как строка

	Признак default_server позволяет обработать запросы, которые иначе остались бы необработанными. Поэтому рекомендуется всегда задавать этот признак явно, чтобы не гадать потом, почему запросы обрабатываются странным образом. Кроме того, признак default_server полезен, когда требуется сконфигурировать несколько виртуальных серверов с одной и той же директивой listen.

	Директива try_files заслуживает особого упоминания. Чаще всего 

Docker

	docker run --name test-nginx -v ~/nginx:/usr/share/nginx/html -d nginx

	docker exec -it container_name bash

	cd /etc/nginx/conf.d/default.conf

	apt-get update

	apt-get install nano

	nano /etc/nginx/nginx.conf

		include /etc/nginx/sites-enabled/*.conf;

	nano /etc/nginx/sites-enabled/kaduk.conf

		server {
			listen 80;
    		server_name kaduk;

		    location / {
		        root   /usr/share/nginx/html;
		        index  index.html index.htm;
		    }
		}


	nano /etc/nginx/conf.d/default.conf	

	http://localhost:8080

Нюансы

	Если создаю nginx в docker, то обязательно нужно пробросить порт.

Команды

	nginx -s reload - перезагрузка конфигурации

	service nginx status