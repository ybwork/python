Оглавление

	Как составлять запрос

	Формат

Как составлять запрос

	Идём по схеме

		Что
			
			name, products

		Откуда

			users, products

		Как получить

			Соединение

				JOIN

			Подзапрос

			Группировка

				group by

				Объединяет значения в одну строку при совпадении значений в столбцах.

			Агрегация

				min, max, avg, count

			Сортировка

				order by

				desc/asc

			Уникальность

				distinct
			
		Условие

			Подзапрос

			Группировка

			Агрегация

			Объединение

			Условия (case)

	Составляем чистый sql запрос (если возможно в разных вариациях)

	Составляем запрос на orm

		помним о кэшировании django запросов

		помним о select/prefetch related
		
	Профилируем запрос/запросы и выбираем самый эффективный

		django

			# работает при debug = True
			from django.db import connection
			print(connection.queries)

			Вспоминаем, что queryset ленивый

			Смотрим, когда вычисляется queryset

			Смотрим на кэширование queryset

				Для использования кэширования в QuerySet можно использовать шаблонный тэг with.

				Если у вас очень много объектов, кэширование в QuerySet может использовать большой объем памяти. В этом случае может помочь iterator().

			Смотрим на кэширование атрибутов

				помнить, что с собственными свойствами нужно самостоятельно реализовать кэширование, используя, например, декоратор cached_property

			Использовать RawSQL, если предыдущие методы не помогают

		Общее

			Смотрим на индексацию

			Смотрим на типы полей

			Выполнять задачи базы данных в базе данных, а не с помощью языка. 

Формат

	SELECT

		name,
		car

	FROM

		users

	JOIN

		cars

	WHERE

		...